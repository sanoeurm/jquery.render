/*! jQuery Render - v1.2.4 - 2012-10-28
* https://github.com/sideroad/jquery.render
* Copyright (c) 2012 sideroad; Licensed MIT, GPL */
/*!
 * jquery.render v1.2.4
 * http://sideroad.secret.jp/
 *
 * Template render plugin
 * 
 * Copyright (c) 2011 sideroad
 *
 * Dual licensed under the MIT or GPL licenses.
 * Date: 2011-03-03
 * 
 * @author sideroad
 * @requires jQuery
 * 
 */
(function(h){var a={},c={},o="",b={},i={},g="en",d=function(s,r){if(!r.length){return s}var q=r.shift();return d(s[q],r)},n=function(s,r,t){var q=r.shift();if(!r.length){s[q]=t;return s}else{if(!s[q]){s[q]={}}return n(s[q],r,t)}},f=function(r){var s=Array.prototype.slice,q=s.call(arguments);q.shift();return function(){var t=s.call(arguments);return r.apply(this,q.concat(t))}},p=function(q){return String(q).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},e=function(t,s,u,r){var q=r.match(/\[(\d+)\]/);if(q&&q[1]){r=q[1]}return u?t[r]:p(t[r])},m=function(q,v,s,u,r){var t=(r=="val")?v:q;return u?t:p(t)},j=function(r){var q=c[g];return r.replace(/\$w\{([^\}]+)\}/g,function(t,s){return p(q[s])})},l=function(q,r){q=h("<div>"+q+"</div>");q.find("[data-render]").each(function(){var w=h(this),x=w.data("render").match(/^\$(?:\{|%7B)(.+)(?:\}|%7D)\.(\w+)$/),s=x[2],B=x[1],v=(B=="this"||B=="")?r:d(r,B.replace(/(\[(\d+)\])/g,".$2").replace(/^\./,"").split(".")),y=0,u,z,t,A,C="";w.removeAttr("data-render");t=(s=="in")?w.html():(s=="each")?w[0].outerHTML:(s=="bind")?w[0].outerHTML:"";if(s=="bind"){A=t;if(h("<div>"+t+"</div>").find("[data-render]").length){A=l(t,v)}C=A.replace(/\$(r?){([^\}]+)}/g,f(e,v)).replace(/\$(r?)(val|key)/g,f(m,B,v))}else{if(v instanceof Array){u=v.length;for(y=0;y<u;y++){z=v[y];A=t;if(h("<div>"+t+"</div>").find("[data-render]").length){A=l(A,z)}C+=A.replace(/\$(r?){([^\}]+)}/g,f(e,z)).replace(/\$(r?)(val)/g,f(m,null,z))}}else{if(typeof v==="object"){for(B in v){z=v[B];A=t;if(h("<div>"+t+"</div>").find("[data-render]").length){A=l(A,z)}C+=A.replace(/\$(r?){([^\}]+)}/g,f(e,z)).replace(/\$(r?)(val|key)/g,f(m,B,z))}}}}s=="in"?w.html(C):s=="each"?w.replaceWith(C):s=="bind"?w.replaceWith(C):""});return q.html()},k=function(q,r){q=l(q,r);var s=q.replace(/\$(r?)\{([^\}]+)\}/g,function(u,w,t){var v=d(r,t.replace(/^this/,"").replace(/(\[(\d+)\])/g,".$2").replace(/^\./,"").split("."));return w?v:p(v)});return(b[g])?j(s):s};h.fn.render=function(q,t){var s=false,r,u;if(typeof q=="object"&&!(q instanceof String)){s=q}if(s){r=s.url+o;u=s.success;return this.each(function(){var y=h(this),x=1,w=function(z){z=h("<div>"+z+"</div>");z.find("[data-include]").each(function(){var A=h(this);A.html(a[A.data("include")]);A.removeAttr("data-include")});return z.find("[data-include]").length?w(z.html()):z.html()},v=function(z){h.ajax(h.extend(true,s,{url:z,dataType:"text",success:function(A){var B=h("<div>"+A+"</div>").find("[data-include]");x=x+B.length-1;a[z]=A;if(x){B.each(function(){v(h(this).data("include"))})}else{y.html(k(w(a[r]),t));if(u){u()}}}}))};if(a[r]){y.html(k(w(a[r]),t));if(u){u()}}else{v(r)}})}else{return this.each(function(){var v=h(this),w=k(q,t);v.html(w)})}};h.word=function(s,r,q,u){var t=q||(navigator.browserLanguage||navigator.language||navigator.userLanguage).substr(0,2);g=t=(s[t])?t:(s[r])?r:"en";if(c[t]){return}else{i[t]=true;h.ajax({url:s[t],dataType:"text",success:function(z){var x=z.split(/\n/),y=x.length,w,v=[];c[t]={};for(w=0;w<y;w++){v=x[w].split(/^([^=]+)=(.+)$/);c[t][v[1]]=v[2]}i[t]=false;b[t]=true;u()}})}};h.renderSuffix=function(s){s=s||{};var r=null,q=h.__render__.userAgent;for(r in s){if(s[r].test(q)){o=r}}};h.clearSuffix=function(){o=""};h.__render__={seek:d,inception:n,escapeHTML:p,word:c,userAgent:navigator.userAgent}})(jQuery);